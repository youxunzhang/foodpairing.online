<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸå¸‚å¿…åƒç¾é£Ÿå…¨å›¾ - è¦†ç›–å…¨å›½åŸå¸‚çš„ç‰¹è‰²é£å‘³</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        .page-intro {
            text-align: center;
            margin: 2.5rem auto;
            padding: 2.5rem 1.5rem;
            max-width: 1100px;
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: #fff;
            border-radius: 24px;
            box-shadow: 0 12px 30px rgba(255, 107, 107, 0.3);
        }

        .page-intro h1 {
            font-size: 2.6rem;
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        .page-intro p {
            font-size: 1.1rem;
            line-height: 1.7;
            opacity: 0.92;
            max-width: 820px;
            margin: 0 auto;
        }

        .city-filter {
            max-width: 1100px;
            margin: 0 auto 2rem;
            padding: 0 1rem;
        }

        .city-filter h3 {
            text-align: center;
            font-size: 1.6rem;
            color: #333;
            margin-bottom: 1.5rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.2rem;
        }

        .filter-group {
            background: #fff;
            border-radius: 18px;
            padding: 1.2rem;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            gap: 0.7rem;
        }

        .filter-label {
            font-weight: 600;
            color: #444;
            font-size: 0.95rem;
        }

        .filter-select,
        .filter-input {
            width: 100%;
            padding: 0.85rem 1rem;
            border-radius: 12px;
            border: 1px solid #e1e4ea;
            background: #f9fafc;
            font-size: 0.95rem;
            color: #333;
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        .filter-select:focus,
        .filter-input:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
            outline: none;
            background: #fff;
        }

        .filter-actions {
            align-items: flex-start;
            justify-content: center;
        }

        .filter-btn {
            width: 100%;
            padding: 0.9rem 1rem;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.25);
        }

        .filter-summary {
            margin-top: 1.2rem;
            font-size: 0.95rem;
            color: #666;
            text-align: center;
        }

        .city-stats {
            max-width: 1100px;
            margin: 0 auto 2.5rem;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
        }

        .stat-card {
            background: #fff;
            border-radius: 18px;
            padding: 1.6rem;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            border-top: 4px solid #ff6b6b;
        }

        .stat-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 0.6rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #ff6b6b;
        }

        .stat-desc {
            font-size: 0.9rem;
            color: #777;
            margin-top: 0.4rem;
            line-height: 1.4;
        }

        .province-section {
            max-width: 1100px;
            margin: 0 auto 3rem;
            padding: 0 1rem;
        }

        .province-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .province-title {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .province-title h2 {
            font-size: 1.9rem;
            color: #333;
            margin: 0;
        }

        .province-emoji {
            font-size: 2.4rem;
        }

        .province-description {
            margin-top: 0.4rem;
            color: #666;
            max-width: 520px;
            line-height: 1.5;
        }

        .province-meta {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            font-size: 0.95rem;
            color: #777;
        }

        .province-meta span {
            background: #fff4f4;
            padding: 0.4rem 0.8rem;
            border-radius: 999px;
            color: #ff6b6b;
            font-weight: 500;
        }

        .province-cities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .city-section {
            background: #fff;
            border-radius: 20px;
            padding: 1.6rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid rgba(255, 107, 107, 0.15);
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }

        .city-header {
            border-bottom: 1px solid #f0f1f5;
            padding-bottom: 1rem;
        }

        .city-title {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1.45rem;
            font-weight: 700;
            color: #333;
        }

        .city-emoji {
            font-size: 2.2rem;
        }

        .city-description {
            margin-top: 0.6rem;
            color: #666;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .city-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.8rem;
        }

        .info-item {
            background: #f8f9fb;
            border-radius: 14px;
            padding: 0.8rem 1rem;
            box-shadow: inset 0 0 0 1px rgba(255, 107, 107, 0.08);
        }

        .info-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 0.4rem;
            font-size: 0.9rem;
        }

        .info-value {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .foods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .food-card {
            background: #fff6f6;
            border-radius: 16px;
            padding: 1.2rem;
            border: 1px solid rgba(255, 107, 107, 0.18);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .food-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(255, 107, 107, 0.2);
        }

        .food-header {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .food-emoji {
            font-size: 2.1rem;
        }

        .food-info h3 {
            margin: 0;
            font-size: 1.15rem;
            color: #333;
        }

        .food-info p {
            margin: 0.2rem 0 0;
            font-size: 0.9rem;
            color: #777;
        }

        .food-description {
            font-size: 0.92rem;
            line-height: 1.5;
            color: #555;
            margin-bottom: 0.8rem;
        }

        .nutrition-info {
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            padding: 0.8rem 1rem;
            margin-bottom: 0.8rem;
        }

        .nutrition-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #444;
            margin-bottom: 0.6rem;
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 0.6rem;
        }

        .nutrition-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #666;
        }

        .nutrition-value {
            font-weight: 600;
            color: #333;
        }

        .food-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.6rem;
        }

        .detail-item {
            background: #fff;
            border-radius: 10px;
            padding: 0.7rem 0.9rem;
            box-shadow: inset 0 0 0 1px rgba(255, 107, 107, 0.12);
            text-align: center;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #777;
            margin-bottom: 0.3rem;
        }

        .detail-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #444;
        }

        .empty-state {
            max-width: 600px;
            margin: 3rem auto;
            text-align: center;
            background: #fff;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            color: #666;
        }

        @media (max-width: 768px) {
            .page-intro {
                margin: 1.5rem;
                padding: 2rem 1.2rem;
            }

            .province-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .province-meta {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .foods-grid {
                grid-template-columns: 1fr;
            }

            .province-cities {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>ğŸ³ <span data-i18n="nav.title">Healthy Breakfast</span></h2>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link" data-i18n="nav.home">Home</a>
                </li>
                <li class="nav-item">
                    <a href="foods.html" class="nav-link" data-i18n="nav.foods">Food Database</a>
                </li>
                <li class="nav-item">
                    <a href="chinese-foods.html" class="nav-link" data-i18n="nav.chinese">Chinese Cuisine</a>
                </li>
                <li class="nav-item">
                    <a href="city-foods.html" class="nav-link active" data-i18n="nav.cityFoods">City Specialties</a>
                </li>
                <li class="nav-item">
                    <a href="food-roulette.html" class="nav-link" data-i18n="nav.foodRoulette">Food Roulette</a>
                </li>
                <li class="nav-item">
                    <a href="lunch-roulette.html" class="nav-link" data-i18n="nav.lunchRoulette">Lunch Roulette</a>
                </li>
                <li class="nav-item">
                    <a href="game.html" class="nav-link" data-i18n="nav.game">Nutrition Game</a>
                </li>
            </ul>
            <div class="language-switcher">
                <button class="lang-btn active" data-lang="zh" onclick="switchLanguage('zh')">ä¸­æ–‡</button>
                <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">English</button>
            </div>
        </div>
    </nav>

    <div class="page-intro">
        <h1 data-i18n="cityFoods.title">ğŸ™ï¸ åŸå¸‚å¿…åƒç¾é£Ÿ</h1>
        <p data-i18n="cityFoods.subtitle">è¦†ç›–å…¨å›½æ‰€æœ‰åŸå¸‚ï¼Œæ¢ç´¢å„åœ°çš„æ‹›ç‰Œé£å‘³ä¸è¥å…»ä¿¡æ¯ã€‚ä»åŒ—äº¬çš„çƒ¤é¸­åˆ°è¥¿å®‰çš„è‚‰å¤¹é¦ï¼Œä»å¹¿å·çš„æ—©èŒ¶åˆ°æ–°ç–†çš„å¤§ç›˜é¸¡ï¼Œéšæ—¶éšåœ°å‘ç°åœ°é“ç¾å‘³ã€‚</p>
    </div>

    <section class="city-filter">
        <h3 data-i18n="cityFoods.selectCityLabel">é€‰æ‹©åŸå¸‚</h3>
        <div class="filter-grid">
            <div class="filter-group">
                <label for="provinceSelect" class="filter-label" data-i18n="cityFoods.selectProvince">é€‰æ‹©çœä»½/åœ°åŒº</label>
                <select id="provinceSelect" class="filter-select"></select>
            </div>
            <div class="filter-group">
                <label for="citySelect" class="filter-label" data-i18n="cityFoods.selectCityLabel">é€‰æ‹©åŸå¸‚</label>
                <select id="citySelect" class="filter-select"></select>
            </div>
            <div class="filter-group">
                <label for="citySearch" class="filter-label" data-i18n="cityFoods.searchLabel">æœç´¢</label>
                <input id="citySearch" class="filter-input" type="text" placeholder="è¾“å…¥åŸå¸‚æˆ–ç¾é£Ÿå…³é”®è¯">
            </div>
            <div class="filter-group filter-actions">
                <button id="showAllCities" class="filter-btn" data-i18n="cityFoods.showAll">æ˜¾ç¤ºå…¨éƒ¨åŸå¸‚</button>
            </div>
        </div>
        <div class="filter-summary" id="filterSummary"></div>
    </section>

    <section class="city-stats">
        <div class="stat-card">
            <div class="stat-label" data-i18n="cityFoods.totalCities">è¦†ç›–åŸå¸‚</div>
            <div class="stat-value" id="totalCityCount">0</div>
            <div class="stat-desc" data-i18n="cityFoods.totalCitiesDesc">è¦†ç›–å…¨å›½å…¨éƒ¨åœ°çº§è¡Œæ”¿åŒº</div>
        </div>
        <div class="stat-card">
            <div class="stat-label" data-i18n="cityFoods.totalFoods">ç‰¹è‰²ç¾é£Ÿ</div>
            <div class="stat-value" id="totalFoodCount">0</div>
            <div class="stat-desc" data-i18n="cityFoods.totalFoodsDesc">æ¯åº§åŸå¸‚é…å¥—è¯¦ç»†çš„ä»£è¡¨èœ</div>
        </div>
        <div class="stat-card">
            <div class="stat-label" data-i18n="cityFoods.totalProvinces">çœä»½/åœ°åŒº</div>
            <div class="stat-value" id="totalProvinceCount">0</div>
            <div class="stat-desc" data-i18n="cityFoods.totalProvincesDesc">åŒ…å«34ä¸ªçœçº§è¡Œæ”¿åŒºåŸŸ</div>
        </div>
    </section>

    <div id="cityFoodsContainer"></div>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p data-i18n="footer.copyright">&copy; 2024 è¥å…»æ—©é¤. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
                <div class="footer-legal-links">
                    <a href="privacy-policy.html" data-i18n="footer.privacyPolicy">éšç§æ”¿ç­–</a>
                    <a href="terms-of-service.html" data-i18n="footer.termsOfService">æœåŠ¡æ¡æ¬¾</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="i18n.js"></script>
    <script src="city-foods-data.js"></script>
    <script>
        let currentLanguage = 'zh';
        let currentProvinceFilter = 'all';
        let currentCityFilter = 'all';
        let currentSearchKeyword = '';
        const filterElements = {};
        let searchTimeout = null;

        document.addEventListener('DOMContentLoaded', () => {
            initializeCityFilter();
            updateCityStats();
            displayCityFoods();
            switchLanguage('zh');
        });

        function initializeCityFilter() {
            filterElements.provinceSelect = document.getElementById('provinceSelect');
            filterElements.citySelect = document.getElementById('citySelect');
            filterElements.searchInput = document.getElementById('citySearch');
            filterElements.showAllButton = document.getElementById('showAllCities');
            filterElements.filterSummary = document.getElementById('filterSummary');

            populateProvinceOptions('all');
            populateCityOptions('all');

            filterElements.provinceSelect.addEventListener('change', () => {
                currentProvinceFilter = filterElements.provinceSelect.value;
                populateCityOptions('all');
                currentCityFilter = 'all';
                displayCityFoods();
            });

            filterElements.citySelect.addEventListener('change', () => {
                currentCityFilter = filterElements.citySelect.value;
                displayCityFoods();
            });

            filterElements.searchInput.addEventListener('input', () => {
                const value = filterElements.searchInput.value.trim();
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    currentSearchKeyword = value;
                    displayCityFoods();
                }, 220);
            });

            filterElements.showAllButton.addEventListener('click', () => {
                currentProvinceFilter = 'all';
                currentCityFilter = 'all';
                currentSearchKeyword = '';
                populateProvinceOptions('all');
                populateCityOptions('all');
                filterElements.searchInput.value = '';
                displayCityFoods();
            });
        }

        function populateProvinceOptions(selectedProvince = 'all') {
            const select = filterElements.provinceSelect;
            if (!select) return;
            const t = translations[currentLanguage]?.cityFoods;
            select.innerHTML = '';

            const allOption = document.createElement('option');
            allOption.value = 'all';
            allOption.textContent = t?.allProvinces || 'å…¨éƒ¨çœä»½/åœ°åŒº';
            select.appendChild(allOption);

            provinceList.forEach(province => {
                const option = document.createElement('option');
                option.value = province.id;
                option.textContent = `${province.emoji} ${province.chineseName} ${province.englishName}`;
                select.appendChild(option);
            });

            const validProvince = Array.from(select.options).some(opt => opt.value === selectedProvince) ? selectedProvince : 'all';
            select.value = validProvince;
            currentProvinceFilter = validProvince;
        }

        function populateCityOptions(selectedCity = 'all') {
            const select = filterElements.citySelect;
            if (!select) return;
            const t = translations[currentLanguage]?.cityFoods;
            select.innerHTML = '';

            const allOption = document.createElement('option');
            allOption.value = 'all';
            allOption.textContent = t?.allCities || 'å…¨éƒ¨åŸå¸‚';
            select.appendChild(allOption);

            const availableCities = currentProvinceFilter === 'all'
                ? cityInfo
                : cityInfo.filter(city => city.provinceId === currentProvinceFilter);

            availableCities
                .slice()
                .sort((a, b) => a.chineseName.localeCompare(b.chineseName, 'zh-CN'))
                .forEach(city => {
                    const option = document.createElement('option');
                    option.value = city.id;
                    option.textContent = `${city.chineseName} ${city.name}`;
                    select.appendChild(option);
                });

            const validCity = Array.from(select.options).some(opt => opt.value === selectedCity) ? selectedCity : 'all';
            select.value = validCity;
            currentCityFilter = validCity;
        }

        function updateCityStats() {
            document.getElementById('totalCityCount').textContent = cityInfo.length;
            document.getElementById('totalFoodCount').textContent = cityFoodsData.length;
            document.getElementById('totalProvinceCount').textContent = provinceList.length;
        }

        function displayCityFoods() {
            const container = document.getElementById('cityFoodsContainer');
            if (!container) return;

            let filteredCities = cityInfo.slice();

            if (currentProvinceFilter !== 'all') {
                filteredCities = filteredCities.filter(city => city.provinceId === currentProvinceFilter);
            }

            if (currentCityFilter !== 'all') {
                filteredCities = filteredCities.filter(city => city.id === currentCityFilter);
            }

            if (currentSearchKeyword) {
                const keyword = currentSearchKeyword.toLowerCase();
                filteredCities = filteredCities.filter(city => {
                    const province = cityProvinceMap[city.id];
                    const foods = cityFoodsMap[city.id] || [];
                    const chineseMatch = city.chineseName.includes(currentSearchKeyword)
                        || city.chineseDescription.includes(currentSearchKeyword)
                        || (province?.chineseName || '').includes(currentSearchKeyword)
                        || (city.famousFor?.zh || []).some(name => name.includes(currentSearchKeyword))
                        || foods.some(food => food.chineseName.includes(currentSearchKeyword) || food.chineseDescription.includes(currentSearchKeyword));
                    const englishMatch = city.name.toLowerCase().includes(keyword)
                        || city.englishDescription.toLowerCase().includes(keyword)
                        || (province?.englishName || '').toLowerCase().includes(keyword)
                        || (city.famousFor?.en || []).some(name => name.toLowerCase().includes(keyword))
                        || foods.some(food => food.name.toLowerCase().includes(keyword) || food.englishDescription.toLowerCase().includes(keyword));
                    return chineseMatch || englishMatch;
                });
            }

            updateFilterSummary(filteredCities.length);
            container.innerHTML = '';

            if (filteredCities.length === 0) {
                const t = translations[currentLanguage]?.cityFoods;
                container.innerHTML = `<div class="empty-state">${t?.noResults || 'æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åŸå¸‚ï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•å§'}</div>`;
                return;
            }

            const grouped = new Map();
            filteredCities.forEach(city => {
                if (!grouped.has(city.provinceId)) {
                    grouped.set(city.provinceId, []);
                }
                grouped.get(city.provinceId).push(city);
            });

            provinceList.forEach(province => {
                const cities = grouped.get(province.id);
                if (!cities || !cities.length) {
                    return;
                }

                const provinceData = provinceMap[province.id];
                const provinceSection = document.createElement('section');
                provinceSection.className = 'province-section';
                provinceSection.id = `province-${province.id}`;

                const descriptionText = provinceData?.description
                    ? (currentLanguage === 'zh' ? provinceData.description.zh : provinceData.description.en)
                    : '';
                const bestTime = provinceData?.bestTime
                    ? (provinceData.bestTime[currentLanguage] || provinceData.bestTime.zh || provinceData.bestTime.en || '')
                    : '';
                const totalFoods = (provinceData?.specialties?.length || 0) * cities.length;
                const t = translations[currentLanguage]?.cityFoods;

                provinceSection.innerHTML = `
                    <div class="province-header">
                        <div class="province-title">
                            <span class="province-emoji">${province.emoji}</span>
                            <div>
                                <h2>${province.chineseName} ${province.englishName}</h2>
                                <p class="province-description">${descriptionText || ''}</p>
                            </div>
                        </div>
                        <div class="province-meta">
                            <span>${bestTime}</span>
                            <span>${cities.length} ${(t?.resultCityUnit) || 'åº§åŸå¸‚'}</span>
                            <span>${totalFoods} ${(t?.totalFoodsUnit) || 'é“ç¾é£Ÿ'}</span>
                        </div>
                    </div>
                `;

                const cityGrid = document.createElement('div');
                cityGrid.className = 'province-cities';

                cities
                    .slice()
                    .sort((a, b) => a.chineseName.localeCompare(b.chineseName, 'zh-CN'))
                    .forEach(city => {
                        const foods = cityFoodsMap[city.id] || [];
                        const citySection = createCitySection(city, foods, provinceData);
                        cityGrid.appendChild(citySection);
                    });

                provinceSection.appendChild(cityGrid);
                container.appendChild(provinceSection);
            });
        }

        function updateFilterSummary(count) {
            const t = translations[currentLanguage]?.cityFoods;
            if (filterElements.filterSummary) {
                filterElements.filterSummary.textContent = `${t?.resultCount || 'åŒ¹é…åŸå¸‚'}: ${count}`;
            }
        }

        function createCitySection(city, foods, province) {
            const section = document.createElement('div');
            section.className = 'city-section';
            section.id = `city-${city.id}`;

            const famousFoods = Array.isArray(city.famousFor)
                ? city.famousFor
                : (city.famousFor?.[currentLanguage] || city.famousFor?.zh || city.famousFor?.en || []);
            const bestTime = typeof city.bestTime === 'string'
                ? city.bestTime
                : (city.bestTime?.[currentLanguage] || city.bestTime?.zh || city.bestTime?.en || '');
            const cityDescription = currentLanguage === 'zh' ? city.chineseDescription : city.englishDescription;

            section.innerHTML = `
                <div class="city-header">
                    <div class="city-title">
                        <span class="city-emoji">${city.emoji || province.emoji}</span>
                        <span>${city.chineseName} ${city.name}</span>
                    </div>
                    <div class="city-description">${cityDescription}</div>
                </div>
                <div class="city-info">
                    <div class="info-item">
                        <div class="info-label">${translations[currentLanguage]?.cityFoods?.bestTime || 'æœ€ä½³æ—¶é—´'}</div>
                        <div class="info-value">${bestTime}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">${translations[currentLanguage]?.cityFoods?.famousFor || 'ç‰¹è‰²ç¾é£Ÿ'}</div>
                        <div class="info-value">${famousFoods.join(currentLanguage === 'zh' ? 'ã€' : ', ')}</div>
                    </div>
                </div>
                <div class="foods-grid">
                    ${foods.map(food => createFoodCard(food)).join('')}
                </div>
            `;

            return section;
        }

        function createFoodCard(food) {
            const bestTime = typeof food.bestTime === 'string'
                ? food.bestTime
                : (food.bestTime?.[currentLanguage] || food.bestTime?.zh || food.bestTime?.en || '');
            const location = typeof food.location === 'string'
                ? food.location
                : (food.location?.[currentLanguage] || food.location?.zh || food.location?.en || '');
            const nutritionLabels = translations[currentLanguage]?.nutrition || {
                calories: 'çƒ­é‡',
                protein: 'è›‹ç™½è´¨',
                carbs: 'ç¢³æ°´',
                fat: 'è„‚è‚ª',
                fiber: 'çº¤ç»´'
            };

            return `
                <div class="food-card">
                    <div class="food-header">
                        <div class="food-emoji">${food.emoji}</div>
                        <div class="food-info">
                            <h3>${food.chineseName}</h3>
                            <p>${food.name}</p>
                        </div>
                    </div>
                    <div class="food-description">${currentLanguage === 'zh' ? food.chineseDescription : food.englishDescription}</div>
                    <div class="nutrition-info">
                        <div class="nutrition-title">${translations[currentLanguage]?.cityFoods?.nutritionInfo || 'è¥å…»ä¿¡æ¯ï¼ˆæ¯100å…‹ï¼‰'}</div>
                        <div class="nutrition-grid">
                            <div class="nutrition-item"><span>${nutritionLabels.calories}</span><span class="nutrition-value">${food.nutrition.calories} kcal</span></div>
                            <div class="nutrition-item"><span>${nutritionLabels.protein}</span><span class="nutrition-value">${food.nutrition.protein} g</span></div>
                            <div class="nutrition-item"><span>${nutritionLabels.carbs}</span><span class="nutrition-value">${food.nutrition.carbs} g</span></div>
                            <div class="nutrition-item"><span>${nutritionLabels.fat}</span><span class="nutrition-value">${food.nutrition.fat} g</span></div>
                            <div class="nutrition-item"><span>${nutritionLabels.fiber}</span><span class="nutrition-value">${food.nutrition.fiber} g</span></div>
                            <div class="nutrition-item"><span>Na</span><span class="nutrition-value">${food.nutrition.sodium} mg</span></div>
                        </div>
                    </div>
                    <div class="food-details">
                        <div class="detail-item">
                            <div class="detail-label">${translations[currentLanguage]?.cityFoods?.price || 'ä»·æ ¼'}</div>
                            <div class="detail-value">${food.price}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${translations[currentLanguage]?.cityFoods?.bestTime || 'æœ€ä½³æ—¶é—´'}</div>
                            <div class="detail-value">${bestTime}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${translations[currentLanguage]?.cityFoods?.location || 'æ¨èåœ°ç‚¹'}</div>
                            <div class="detail-value">${location}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function switchLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            const targetButton = document.querySelector(`[data-lang="${lang}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            updatePageContent();
        }

        function updatePageContent() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const value = key.split('.').reduce((acc, part) => acc && acc[part], translations[currentLanguage]);
                if (value) {
                    element.textContent = value;
                }
            });

            const searchPlaceholder = translations[currentLanguage]?.cityFoods?.searchPlaceholder || 'è¾“å…¥åŸå¸‚æˆ–ç¾é£Ÿå…³é”®è¯';
            if (filterElements.searchInput) {
                filterElements.searchInput.placeholder = searchPlaceholder;
            }

            populateProvinceOptions(currentProvinceFilter);
            populateCityOptions(currentCityFilter);
            updateCityStats();
            displayCityFoods();
        }
    </script>
</body>
</html>
