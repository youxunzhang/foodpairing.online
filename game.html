<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥å…»æ­é…æŒ‘æˆ˜ - è¥å…»æ—©é¤</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>ğŸ³ è¥å…»æ—©é¤</h2>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">é¦–é¡µ</a>
                </li>
                <li class="nav-item">
                    <a href="foods.html" class="nav-link">é£Ÿç‰©åº“</a>
                </li>
                <li class="nav-item">
                    <a href="chinese-foods.html" class="nav-link">ä¸­å›½ç¾é£Ÿ</a>
                </li>
                <li class="nav-item">
                    <a href="city-foods.html" class="nav-link">åŸå¸‚ç¾é£Ÿ</a>
                </li>
                <li class="nav-item">
                    <a href="food-roulette.html" class="nav-link">é£Ÿç‰©å¤§è½¬ç›˜</a>
                </li>
                <li class="nav-item">
                    <a href="lunch-roulette.html" class="nav-link">Lunch Roulette</a>
                </li>
                <li class="nav-item">
                    <a href="game.html" class="nav-link active">è¥å…»æ¸¸æˆ</a>
                </li>
            </ul>
            <div class="language-switcher">
                <button class="lang-btn" onclick="switchLanguage('zh')">ä¸­æ–‡</button>
                <button class="lang-btn active" onclick="switchLanguage('en')">English</button>
            </div>
        </div>
    </nav>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <header class="page-header">
        <div class="container">
            <h1 data-i18n="game.title">è¥å…»æ­é…æŒ‘æˆ˜</h1>
            <p data-i18n="game.subtitle">é€šè¿‡æ­é…é£Ÿç‰©å®Œæˆè¥å…»ç›®æ ‡ï¼Œå­¦ä¹ å¥åº·é¥®é£ŸçŸ¥è¯†</p>
            
            <!-- åˆ†äº«æŒ‰é’® -->
            <div class="share-section">
                <h4 data-i18n="share.title">åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“</h4>
                <div class="share-buttons">
                    <button class="share-btn facebook" onclick="shareToFacebook()" title="Facebook">
                        <span class="share-icon">ğŸ“˜</span>
                        <span class="share-text" data-i18n="share.facebook">Facebook</span>
                    </button>
                    <button class="share-btn twitter" onclick="shareToTwitter()" title="Twitter">
                        <span class="share-icon">ğŸ¦</span>
                        <span class="share-text" data-i18n="share.twitter">Twitter</span>
                    </button>
                    <button class="share-btn linkedin" onclick="shareToLinkedIn()" title="LinkedIn">
                        <span class="share-icon">ğŸ’¼</span>
                        <span class="share-text" data-i18n="share.linkedin">LinkedIn</span>
                    </button>
                    <button class="share-btn whatsapp" onclick="shareToWhatsApp()" title="WhatsApp">
                        <span class="share-icon">ğŸ’¬</span>
                        <span class="share-text" data-i18n="share.whatsapp">WhatsApp</span>
                    </button>
                    <button class="share-btn telegram" onclick="shareToTelegram()" title="Telegram">
                        <span class="share-icon">ğŸ“±</span>
                        <span class="share-text" data-i18n="share.telegram">Telegram</span>
                    </button>
                    <button class="share-btn email" onclick="shareToEmail()" title="Email">
                        <span class="share-icon">ğŸ“§</span>
                        <span class="share-text" data-i18n="share.email">Email</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- æ¸¸æˆæ§åˆ¶é¢æ¿ -->
    <section class="game-header">
        <div class="container">
            <div class="game-controls">
                <div class="game-info">
                    <div class="score-board">
                        <div class="score-item">
                            <div class="score-label" data-i18n="game.score">å¾—åˆ†</div>
                            <div class="score-value" id="score">0</div>
                        </div>
                        <div class="score-item">
                            <div class="score-label" data-i18n="game.level">å…³å¡</div>
                            <div class="score-value" id="level">1</div>
                        </div>
                        <div class="score-item">
                            <div class="score-label" data-i18n="game.time">æ—¶é—´</div>
                            <div class="score-value" id="timer">60</div>
                        </div>
                    </div>
                    
                    <div class="game-buttons">
                        <button class="game-btn primary" id="startBtn" onclick="startGame()" data-i18n="game.start">å¼€å§‹æ¸¸æˆ</button>
                        <button class="game-btn secondary" id="pauseBtn" onclick="pauseGame()" disabled data-i18n="game.pause">æš‚åœ</button>
                        <button class="game-btn secondary" id="restartBtn" onclick="restartGame()" data-i18n="game.restart">é‡æ–°å¼€å§‹</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- æ¸¸æˆä¸»è¦å†…å®¹ -->
    <section class="game-main">
        <div class="container">
            <div class="game-layout">
                <!-- å·¦ä¾§ï¼šè¥å…»ç›®æ ‡ -->
                <div class="game-targets">
                    <h3 data-i18n="game.nutritionTargets">è¥å…»ç›®æ ‡</h3>
                    <div class="target-list" id="targetList">
                        <!-- è¥å…»ç›®æ ‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>

                <!-- ä¸­é—´ï¼šé£Ÿç‰©é€‰æ‹© -->
                <div class="food-selection">
                    <h3 data-i18n="game.selectFoods">é€‰æ‹©é£Ÿç‰©</h3>
                    <div class="game-food-grid" id="gameFoodGrid">
                        <!-- é£Ÿç‰©é€‰æ‹©å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>

                <!-- å³ä¾§ï¼šå½“å‰é€‰æ‹©å’Œè¥å…»æ˜¾ç¤º -->
                <div class="game-info-panel">
                    <div class="current-foods">
                        <h4 data-i18n="game.selectedFoods">å·²é€‰é£Ÿç‰©</h4>
                        <div id="currentFoodsList">
                            <!-- å½“å‰é€‰æ‹©çš„é£Ÿç‰©å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                        <button class="action-btn secondary" onclick="clearGameSelection()" data-i18n="game.clearSelection">æ¸…ç©ºé€‰æ‹©</button>
                    </div>

                    <div class="nutrition-display">
                        <h4 data-i18n="game.currentNutrition">å½“å‰è¥å…»</h4>
                        <div class="nutrition-row">
                            <span data-i18n="nutrition.calories">çƒ­é‡:</span>
                            <span id="currentCalories">0 kcal</span>
                        </div>
                        <div class="nutrition-row">
                            <span data-i18n="nutrition.protein">è›‹ç™½è´¨:</span>
                            <span id="currentProtein">0g</span>
                        </div>
                        <div class="nutrition-row">
                            <span data-i18n="nutrition.carbs">ç¢³æ°´åŒ–åˆç‰©:</span>
                            <span id="currentCarbs">0g</span>
                        </div>
                        <div class="nutrition-row">
                            <span data-i18n="nutrition.fat">è„‚è‚ª:</span>
                            <span id="currentFat">0g</span>
                        </div>
                        <div class="nutrition-row">
                            <span data-i18n="nutrition.fiber">çº¤ç»´:</span>
                            <span id="currentFiber">0g</span>
                        </div>
                    </div>

                    <div class="game-actions">
                        <button class="action-btn primary" onclick="checkGameTarget()" data-i18n="game.checkTarget">æ£€æŸ¥ç›®æ ‡</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- æ¸¸æˆè¯´æ˜ -->
    <section class="game-instructions">
        <div class="container">
            <h3 data-i18n="game.howToPlay">æ¸¸æˆè¯´æ˜</h3>
            <div class="instructions-grid">
                <div class="instruction-card">
                    <div class="instruction-icon">ğŸ¯</div>
                    <h4 data-i18n="game.instruction1.title">è®¾å®šç›®æ ‡</h4>
                    <p data-i18n="game.instruction1.desc">æŸ¥çœ‹å·¦ä¾§çš„è¥å…»ç›®æ ‡ï¼Œäº†è§£éœ€è¦è¾¾åˆ°çš„è¥å…»è¦æ±‚</p>
                </div>
                <div class="instruction-card">
                    <div class="instruction-icon">ğŸ½ï¸</div>
                    <h4 data-i18n="game.instruction2.title">é€‰æ‹©é£Ÿç‰©</h4>
                    <p data-i18n="game.instruction2.desc">ä»ä¸­é—´çš„é£Ÿç‰©åº“ä¸­é€‰æ‹©åˆé€‚çš„é£Ÿç‰©è¿›è¡Œæ­é…</p>
                </div>
                <div class="instruction-card">
                    <div class="instruction-icon">ğŸ“Š</div>
                    <h4 data-i18n="game.instruction3.title">æŸ¥çœ‹è¥å…»</h4>
                    <p data-i18n="game.instruction3.desc">å³ä¾§å®æ—¶æ˜¾ç¤ºå½“å‰é€‰æ‹©çš„è¥å…»ä¿¡æ¯</p>
                </div>
                <div class="instruction-card">
                    <div class="instruction-icon">âœ…</div>
                    <h4 data-i18n="game.instruction4.title">å®ŒæˆæŒ‘æˆ˜</h4>
                    <p data-i18n="game.instruction4.desc">ç‚¹å‡»æ£€æŸ¥ç›®æ ‡ï¼Œçœ‹æ˜¯å¦è¾¾åˆ°è¥å…»è¦æ±‚</p>
                </div>
            </div>
        </div>
    </section>

    <!-- æ¸¸æˆç»“æœæ¨¡æ€æ¡† -->
    <div id="gameResultModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeGameModal()">&times;</span>
            <div id="gameResultContent">
                <!-- æ¸¸æˆç»“æœå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 data-i18n="footer.title">ğŸ³ è¥å…»æ—©é¤</h3>
                    <p data-i18n="footer.slogan">è®©å¥åº·ç”Ÿæ´»ä»æ¯ä¸€é¡¿è¥å…»æ—©é¤å¼€å§‹</p>
                </div>
                <div class="footer-section">
                    <h4 data-i18n="footer.quickLinks">å¿«é€Ÿé“¾æ¥</h4>
                    <ul>
                        <li><a href="index.html" data-i18n="nav.home">é¦–é¡µ</a></li>
                        <li><a href="foods.html" data-i18n="nav.foods">é£Ÿç‰©åº“</a></li>
                        <li><a href="game.html" data-i18n="nav.game">è¥å…»æ¸¸æˆ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 data-i18n="footer.contact">è”ç³»æˆ‘ä»¬</h4>
                    <p>ğŸ“§ <span data-i18n="footer.email">é‚®ç®±</span>: <span data-i18n="footer.emailAddress">0</span></p>
                    <p>ğŸ“± <span data-i18n="footer.wechat">å¾®ä¿¡</span>: zhangyouxun2013</p>
                    <p>ğŸ“ <span data-i18n="footer.phone">ç”µè¯</span>: <span data-i18n="footer.phoneNumber">0</span></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p data-i18n="footer.copyright">&copy; 2024 è¥å…»æ—©é¤. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
                <p><a href="https://www.seodog.cn" target="_blank" rel="noopener noreferrer" class="ai-tools-link"><span class="link-icon">ğŸ”—</span> <span data-i18n="footer.aiTools">AIå·¥å…·å¯¼èˆª</span> - SEOdog.cn</a></p>
            </div>
        </div>
    </footer>

    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="i18n.js"></script>
    <script src="foods-data.js"></script>
    <script src="script.js"></script>
    
    <script>
        // æ¸¸æˆç›¸å…³çš„å…¨å±€å˜é‡
        let gameState = {
            isActive: false,
            score: 0,
            level: 1,
            timeLeft: 60,
            selectedFoods: [],
            currentTargets: [],
            timer: null
        };

        // é¡µé¢ç‰¹å®šçš„JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è¥å…»æ¸¸æˆé¡µé¢åŠ è½½å®Œæˆ');
            
            // åˆå§‹åŒ–å›½é™…åŒ–
            if (typeof updateLanguage === 'function') {
                updateLanguage();
            }
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initializeGame();
            
            console.log('è¥å…»æ¸¸æˆé¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });

        // åˆå§‹åŒ–æ¸¸æˆ
        function initializeGame() {
            console.log('åˆå§‹åŒ–æ¸¸æˆ...');
            
            // åŠ è½½æ¸¸æˆå…³å¡
            loadGameLevel();
            
            // åŠ è½½é£Ÿç‰©é€‰æ‹©
            loadGameFoodSelection();
            
            // æ›´æ–°æ˜¾ç¤º
            updateGameDisplay();
            updateGameNutritionDisplay();
            
            console.log('æ¸¸æˆåˆå§‹åŒ–å®Œæˆ');
        }

        // åŠ è½½æ¸¸æˆå…³å¡
        function loadGameLevel() {
            console.log('åŠ è½½æ¸¸æˆå…³å¡:', gameState.level);
            
            // å®šä¹‰å…³å¡ç›®æ ‡
            const levelTargets = [
                {
                    level: 1,
                    targets: [
                        { type: 'calories', min: 200, max: 400, label: 'çƒ­é‡ 200-400 kcal' },
                        { type: 'protein', min: 10, max: 25, label: 'è›‹ç™½è´¨ 10-25g' }
                    ]
                },
                {
                    level: 2,
                    targets: [
                        { type: 'calories', min: 300, max: 500, label: 'çƒ­é‡ 300-500 kcal' },
                        { type: 'protein', min: 15, max: 30, label: 'è›‹ç™½è´¨ 15-30g' },
                        { type: 'carbs', min: 30, max: 60, label: 'ç¢³æ°´åŒ–åˆç‰© 30-60g' }
                    ]
                },
                {
                    level: 3,
                    targets: [
                        { type: 'calories', min: 400, max: 600, label: 'çƒ­é‡ 400-600 kcal' },
                        { type: 'protein', min: 20, max: 35, label: 'è›‹ç™½è´¨ 20-35g' },
                        { type: 'carbs', min: 40, max: 70, label: 'ç¢³æ°´åŒ–åˆç‰© 40-70g' },
                        { type: 'fiber', min: 5, max: 15, label: 'çº¤ç»´ 5-15g' }
                    ]
                }
            ];

            // è·å–å½“å‰å…³å¡ç›®æ ‡
            const currentLevel = levelTargets.find(l => l.level === gameState.level) || levelTargets[0];
            gameState.currentTargets = currentLevel.targets;

            // æ˜¾ç¤ºç›®æ ‡
            displayGameTargets();
        }

        // æ˜¾ç¤ºæ¸¸æˆç›®æ ‡
        function displayGameTargets() {
            const targetList = document.getElementById('targetList');
            if (!targetList) return;

            targetList.innerHTML = '';
            gameState.currentTargets.forEach(target => {
                const targetItem = document.createElement('div');
                targetItem.className = 'target-item';
                targetItem.innerHTML = `
                    <h4>${target.label}</h4>
                    <div class="target-range">ç›®æ ‡èŒƒå›´</div>
                `;
                targetList.appendChild(targetItem);
            });
        }

        // åŠ è½½æ¸¸æˆé£Ÿç‰©é€‰æ‹©
        function loadGameFoodSelection() {
            console.log('åŠ è½½æ¸¸æˆé£Ÿç‰©é€‰æ‹©...');
            
            if (typeof foodsData === 'undefined') {
                console.error('foodsData æœªå®šä¹‰');
                return;
            }

            const gameFoodGrid = document.getElementById('gameFoodGrid');
            if (!gameFoodGrid) return;

            // é€‰æ‹©ä¸€äº›é€‚åˆæ¸¸æˆçš„é£Ÿç‰©
            const gameFoods = foodsData.slice(0, 20); // å–å‰20ç§é£Ÿç‰©

            gameFoodGrid.innerHTML = '';
            gameFoods.forEach(food => {
                const foodCard = createGameFoodCard(food);
                gameFoodGrid.appendChild(foodCard);
            });

            console.log('æ¸¸æˆé£Ÿç‰©é€‰æ‹©åŠ è½½å®Œæˆ');
        }

        // åˆ›å»ºæ¸¸æˆé£Ÿç‰©å¡ç‰‡
        function createGameFoodCard(food) {
            const card = document.createElement('div');
            card.className = 'game-food-card';
            card.setAttribute('data-food-id', food.id);
            
            card.innerHTML = `
                <div class="emoji">${food.emoji}</div>
                <div class="name">${food.name}</div>
                <div class="nutrition-info">
                    <div class="nutrition-item">
                        <span class="label">çƒ­é‡:</span>
                        <span class="value">${food.calories}kcal</span>
                    </div>
                    <div class="nutrition-item">
                        <span class="label">è›‹ç™½è´¨:</span>
                        <span class="value">${food.protein}g</span>
                    </div>
                </div>
            `;
            
            card.addEventListener('click', () => toggleGameFoodSelection(food));
            
            return card;
        }

        // åˆ‡æ¢æ¸¸æˆé£Ÿç‰©é€‰æ‹©
        function toggleGameFoodSelection(food) {
            const existingIndex = gameState.selectedFoods.findIndex(f => f.id === food.id);
            
            if (existingIndex >= 0) {
                // ç§»é™¤é£Ÿç‰©
                gameState.selectedFoods.splice(existingIndex, 1);
                document.querySelector(`[data-food-id="${food.id}"]`).classList.remove('selected');
            } else {
                // æ·»åŠ é£Ÿç‰©
                gameState.selectedFoods.push(food);
                document.querySelector(`[data-food-id="${food.id}"]`).classList.add('selected');
            }
            
            updateGameCurrentFoods();
            updateGameNutritionDisplay();
        }

        // æ›´æ–°å½“å‰é€‰æ‹©çš„é£Ÿç‰©æ˜¾ç¤º
        function updateGameCurrentFoods() {
            const currentFoodsList = document.getElementById('currentFoodsList');
            if (!currentFoodsList) return;

            currentFoodsList.innerHTML = '';
            gameState.selectedFoods.forEach(food => {
                const foodItem = document.createElement('div');
                foodItem.className = 'current-food-item';
                foodItem.innerHTML = `
                    <span>${food.emoji} ${food.name}</span>
                    <button onclick="removeGameFood(${food.id})" class="remove-btn">Ã—</button>
                `;
                currentFoodsList.appendChild(foodItem);
            });
        }

        // ç§»é™¤æ¸¸æˆé£Ÿç‰©
        function removeGameFood(foodId) {
            gameState.selectedFoods = gameState.selectedFoods.filter(f => f.id !== foodId);
            document.querySelector(`[data-food-id="${foodId}"]`).classList.remove('selected');
            updateGameCurrentFoods();
            updateGameNutritionDisplay();
        }

        // æ¸…ç©ºæ¸¸æˆé€‰æ‹©
        function clearGameSelection() {
            gameState.selectedFoods = [];
            document.querySelectorAll('.game-food-card').forEach(card => {
                card.classList.remove('selected');
            });
            updateGameCurrentFoods();
            updateGameNutritionDisplay();
        }

        // æ›´æ–°æ¸¸æˆè¥å…»æ˜¾ç¤º
        function updateGameNutritionDisplay() {
            const nutrition = calculateGameNutrition(gameState.selectedFoods);
            
            document.getElementById('currentCalories').textContent = `${nutrition.calories} kcal`;
            document.getElementById('currentProtein').textContent = `${nutrition.protein}g`;
            document.getElementById('currentCarbs').textContent = `${nutrition.carbs}g`;
            document.getElementById('currentFat').textContent = `${nutrition.fat}g`;
            document.getElementById('currentFiber').textContent = `${nutrition.fiber}g`;
        }

        // è®¡ç®—æ¸¸æˆè¥å…»
        function calculateGameNutrition(foods) {
            return foods.reduce((total, food) => {
                total.calories += food.calories;
                total.protein += food.protein;
                total.carbs += food.carbs;
                total.fat += food.fat;
                total.fiber += food.fiber || 0;
                return total;
            }, { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0 });
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            console.log('å¼€å§‹æ¸¸æˆ');
            gameState.isActive = true;
            gameState.timeLeft = 60;
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            
            // å¼€å§‹è®¡æ—¶å™¨
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                updateGameDisplay();
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
            
            updateGameDisplay();
        }

        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            console.log('æš‚åœæ¸¸æˆ');
            gameState.isActive = false;
            
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            console.log('é‡æ–°å¼€å§‹æ¸¸æˆ');
            
            // åœæ­¢å½“å‰æ¸¸æˆ
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState = {
                isActive: false,
                score: 0,
                level: 1,
                timeLeft: 60,
                selectedFoods: [],
                currentTargets: [],
                timer: null
            };
            
            // é‡æ–°åˆå§‹åŒ–
            initializeGame();
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
        }

        // æ›´æ–°æ¸¸æˆæ˜¾ç¤º
        function updateGameDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('timer').textContent = gameState.timeLeft;
        }

        // æ£€æŸ¥æ¸¸æˆç›®æ ‡
        function checkGameTarget() {
            console.log('æ£€æŸ¥æ¸¸æˆç›®æ ‡');
            
            if (gameState.selectedFoods.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©ä¸€äº›é£Ÿç‰©ï¼');
                return;
            }
            
            const nutrition = calculateGameNutrition(gameState.selectedFoods);
            let allTargetsMet = true;
            let metTargets = 0;
            
            // æ£€æŸ¥æ¯ä¸ªç›®æ ‡
            gameState.currentTargets.forEach(target => {
                const value = nutrition[target.type];
                const isMet = value >= target.min && value <= target.max;
                
                if (isMet) {
                    metTargets++;
                } else {
                    allTargetsMet = false;
                }
            });
            
            // è®¡ç®—å¾—åˆ†
            const targetScore = Math.floor((metTargets / gameState.currentTargets.length) * 100);
            gameState.score += targetScore;
            
            // æ˜¾ç¤ºç»“æœ
            showGameResult(targetScore, allTargetsMet, nutrition);
            
            updateGameDisplay();
        }

        // æ˜¾ç¤ºæ¸¸æˆç»“æœ
        function showGameResult(score, allTargetsMet, nutrition) {
            const modal = document.getElementById('gameResultModal');
            const content = document.getElementById('gameResultContent');
            
            if (!modal || !content) return;
            
            const resultHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">
                        ${allTargetsMet ? 'ğŸ‰' : 'ğŸ“Š'}
                    </div>
                    <h2 style="color: ${allTargetsMet ? '#28a745' : '#ffc107'}; margin-bottom: 15px;">
                        ${allTargetsMet ? 'æ­å–œï¼ç›®æ ‡è¾¾æˆï¼' : 'ç»§ç»­åŠªåŠ›ï¼'}
                    </h2>
                    <p style="color: #666; margin-bottom: 20px;">
                        æœ¬æ¬¡å¾—åˆ†: ${score} åˆ†
                    </p>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px;">å½“å‰è¥å…»å€¼</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; text-align: left;">
                            <div>çƒ­é‡: ${nutrition.calories} kcal</div>
                            <div>è›‹ç™½è´¨: ${nutrition.protein}g</div>
                            <div>ç¢³æ°´åŒ–åˆç‰©: ${nutrition.carbs}g</div>
                            <div>è„‚è‚ª: ${nutrition.fat}g</div>
                            <div>çº¤ç»´: ${nutrition.fiber}g</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="closeGameModal()" style="background: linear-gradient(135deg, #ff6b6b, #ffa500); color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-weight: 600;">
                            ç»§ç»­æ¸¸æˆ
                        </button>
                        ${allTargetsMet ? `
                            <button onclick="nextLevel()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-weight: 600;">
                                ä¸‹ä¸€å…³
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            content.innerHTML = resultHTML;
            modal.style.display = 'block';
        }

        // å…³é—­æ¸¸æˆç»“æœæ¨¡æ€æ¡†
        function closeGameModal() {
            const modal = document.getElementById('gameResultModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // ä¸‹ä¸€å…³
        function nextLevel() {
            gameState.level++;
            closeGameModal();
            clearGameSelection();
            loadGameLevel();
            updateGameDisplay();
            
            if (gameState.level > 3) {
                showToast('æ­å–œé€šå…³ï¼ä½ å·²ç»å®Œæˆäº†æ‰€æœ‰å…³å¡ï¼');
            }
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            console.log('æ¸¸æˆç»“æŸ');
            
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            gameState.isActive = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            showToast(`æ¸¸æˆç»“æŸï¼æœ€ç»ˆå¾—åˆ†: ${gameState.score} åˆ†`);
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showToast(message) {
            // åˆ›å»ºtoastå…ƒç´ 
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ff6b6b, #ffa500);
                color: white;
                padding: 15px 20px;
                border-radius: 25px;
                box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            
            // æ·»åŠ åŠ¨ç”»æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(toast);
            
            // 3ç§’åç§»é™¤
            setTimeout(() => {
                toast.remove();
                style.remove();
            }, 3000);
        }
    </script>
</body>
</html> 